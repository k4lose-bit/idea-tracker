<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Lab Pro - ìƒê° & ì¼ì • í†µí•© ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; }
        .thought-stack { display: flex; flex-direction: column-reverse; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function BrainLab() {
            // --- ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ ---
            const [thoughts, setThoughts] = useState(JSON.parse(localStorage.getItem('brain_thoughts') || '[]'));
            const [events, setEvents] = useState(JSON.parse(localStorage.getItem('brain_events') || '{}'));
            
            // --- UI ìƒíƒœ ---
            const [input, setInput] = useState('');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [aiSuggestion, setAiSuggestion] = useState(null);
            const [isAiWorking, setIsAiWorking] = useState(false);
            const apiKey = localStorage.getItem('openai_key') || '';

            useEffect(() => {
                localStorage.setItem('brain_thoughts', JSON.stringify(thoughts));
                localStorage.setItem('brain_events', JSON.stringify(events));
                lucide.createIcons();
            }, [thoughts, events]);

            // --- 1. ìœ ì‚¬ ìƒê° ê²€ìƒ‰ ë¡œì§ (Simple Keyword Match) ---
            const similarThought = useMemo(() => {
                if (input.length < 5) return null;
                const keywords = input.split(' ').filter(w => w.length > 1);
                return thoughts.find(t => 
                    keywords.some(k => t.content.includes(k)) && t.content !== input
                );
            }, [input, thoughts]);

            // --- 2. AI í”„ë¡œì íŠ¸ ë¹Œë“œì—… (ì½”ë“œ ë° êµ¬ì„± ì œì•ˆ) ---
            const buildUpProject = async () => {
                if (!apiKey || !input.trim()) {
                    alert('OpenAI API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.\n\nì„¤ì • ë°©ë²•:\nlocalStorage.setItem("openai_key", "your-api-key")\n\në˜ëŠ” ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.');
                    return;
                }
                setIsAiWorking(true);
                try {
                    const res = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: "gpt-4o-mini",
                            messages: [
                                { role: "system", content: "ì‚¬ìš©ìì˜ ì•„ì´ë””ì–´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í”„ë¡œì íŠ¸ êµ¬ì„±ì•ˆê³¼ í•µì‹¬ ì½”ë“œë¥¼ ì œì•ˆí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ êµ¬ì²´ì ìœ¼ë¡œ ì œì•ˆí•˜ì„¸ìš”." },
                                { role: "user", content: input }
                            ]
                        })
                    });
                    const data = await res.json();
                    setAiSuggestion(data.choices[0].message.content);
                } catch (e) { 
                    alert("AI í˜¸ì¶œ ì‹¤íŒ¨: " + e.message); 
                } finally { 
                    setIsAiWorking(false); 
                }
            };

            // --- 3. ìº˜ë¦°ë” ì¼ì • ê¸°ë¡ ---
            const addEvent = (e) => {
                if(e.key === 'Enter' && e.target.value.trim()) {
                    const val = e.target.value;
                    setEvents({ ...events, [selectedDate]: [...(events[selectedDate] || []), val] });
                    e.target.value = '';
                }
            };

            return (
                <div className="flex h-screen p-4 gap-4 overflow-hidden">
                    {/* [LEFT] ìŠ¤ë§ˆíŠ¸ ìº˜ë¦°ë” ì„¹ì…˜ */}
                    <aside className="w-80 flex flex-col gap-4">
                        <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                            <h3 className="font-black text-slate-800 mb-4 flex items-center gap-2">
                                <i data-lucide="calendar"></i> ì¼ì • ê´€ë¦¬
                            </h3>
                            <input 
                                type="date" 
                                value={selectedDate}
                                onChange={(e) => setSelectedDate(e.target.value)}
                                className="w-full mb-4 p-2 bg-slate-50 border-none rounded-xl text-sm font-bold"
                            />
                            <div className="space-y-2 max-h-40 overflow-y-auto custom-scroll">
                                {(events[selectedDate] || []).map((ev, i) => (
                                    <div key={i} className="flex items-center gap-2 text-xs text-slate-600 bg-indigo-50 p-2 rounded-lg">
                                        <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full"></div> {ev}
                                    </div>
                                ))}
                            </div>
                            <input 
                                onKeyDown={addEvent}
                                placeholder="+ ì¼ì • ì¶”ê°€ (Enter)"
                                className="w-full mt-4 p-2 text-xs border-b border-slate-100 outline-none focus:border-indigo-400"
                            />
                        </div>

                        <div className="flex-1 bg-slate-900 text-white p-6 rounded-[2rem] overflow-hidden flex flex-col">
                            <h4 className="text-xs font-bold text-indigo-400 uppercase mb-4 tracking-widest">AI Build-up Workshop</h4>
                            <div className="flex-1 overflow-y-auto custom-scroll text-[13px] leading-relaxed opacity-90">
                                {isAiWorking ? <div className="animate-pulse">AIê°€ í”„ë¡œì íŠ¸ ì„¤ê³„ë¥¼ êµ¬ì„± ì¤‘ì…ë‹ˆë‹¤...</div> : 
                                 aiSuggestion ? <div className="whitespace-pre-wrap">{aiSuggestion}</div> : 
                                 "ì¤‘ì•™ì— ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ê³  'AI ì œì•ˆë°›ê¸°'ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”."}
                            </div>
                        </div>
                    </aside>

                    {/* [CENTER] ìƒê° ë°ì´í„°ë² ì´ìŠ¤ (íƒ‘ì²˜ëŸ¼ ìŒ“ì„) */}
                    <main className="flex-1 flex flex-col gap-4">
                        <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-200 relative">
                            {similarThought && (
                                <div className="absolute -top-4 left-10 bg-amber-100 text-amber-700 px-4 py-2 rounded-full text-xs font-bold border border-amber-200 shadow-sm animate-bounce">
                                    ğŸ’¡ ì˜ˆì „ì— ë¹„ìŠ·í•œ ìƒê°ì„ í•˜ì…¨ì–´ìš”: "{similarThought.content.substring(0, 20)}..."
                                </div>
                            )}
                            <textarea 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                className="w-full h-32 text-xl border-none focus:ring-0 placeholder:text-slate-200 resize-none font-medium"
                                placeholder="ì§€ê¸ˆ ì–´ë–¤ ìƒê°ì„ í•˜ê³  ê³„ì‹ ê°€ìš”?"
                            />
                            <div className="flex justify-between mt-4">
                                <button onClick={buildUpProject} className="flex items-center gap-2 text-indigo-600 font-bold text-sm">
                                    <i data-lucide="zap" className="w-4 fill-indigo-600"></i> AI í”„ë¡œì íŠ¸ ì œì•ˆë°›ê¸°
                                </button>
                                <button 
                                    onClick={() => {
                                        if (!input.trim()) return;
                                        setThoughts([{ id: Date.now(), content: input, date: new Date().toLocaleString() }, ...thoughts]);
                                        setInput('');
                                    }}
                                    className="bg-indigo-600 text-white px-10 py-3 rounded-2xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-100"
                                >
                                    ìƒê° ì €ì¥
                                </button>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scroll pr-2">
                            <div className="thought-stack gap-4">
                                {thoughts.map(t => (
                                    <div key={t.id} className="bg-white p-6 rounded-3xl border border-slate-200 hover:border-indigo-300 transition group">
                                        <div className="flex justify-between mb-2">
                                            <span className="text-[10px] text-slate-400 font-mono">{t.date}</span>
                                            <button onClick={() => setThoughts(thoughts.filter(th => th.id !== t.id))} className="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500"><i data-lucide="trash-2" className="w-4"></i></button>
                                        </div>
                                        <p className="text-slate-700 leading-relaxed">{t.content}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BrainLab />);
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>